<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Prediction Interface - Fixed</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { background-color: #1F2937; color: #F9FAFB; font-family: sans-serif; }
        .card { background-color: #374151; }
        .win { color: #10B981; } /* Green */
        .loss { color: #EF4444; } /* Red */
        .error-text { color: #F87171; } /* Light Red for Errors */
        .loading-animation {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #6366F1;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 0.5rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 max-w-lg">
        <h1 class="text-3xl font-bold text-center mb-6 text-indigo-400">Live Prediction Interface</h1>
        <p class="text-center text-sm mb-4 text-yellow-300">
            **⚠️ Important:** Kripya JavaScript section mein **`YOUR_...`** placeholders ko apne asli credentials se badlein.
        </p>

        <div class="card p-6 rounded-xl shadow-2xl mb-6">
            <h2 class="text-xl font-semibold mb-4 border-b border-gray-600 pb-2">Current Period & Prediction</h2>
            
            <div class="flex justify-between items-center text-lg font-mono">
                <div>
                    <span class="text-gray-400">PERIOD:</span> 
                    <span id="currentPeriod" class="text-yellow-400 font-bold text-2xl">
                        <div class="loading-animation"></div> Loading...
                    </span>
                </div>
                <div>
                    <span class="text-gray-400">PREDICTION:</span> 
                    <span id="currentPrediction" class="prediction-text text-4xl font-extrabold text-white">---</span>
                </div>
            </div>
        </div>

        <div class="card p-6 rounded-xl shadow-2xl">
            <h2 class="text-xl font-semibold mb-4 border-b border-gray-600 pb-2">History (Win/Loss)</h2>
            
            <div id="historyList" class="space-y-2 max-h-80 overflow-y-auto">
                <p class="text-center text-gray-400">History loading...</p>
            </div>
        </div>
    </div>

    <script>
        // =======================================================
        // 1. MUKHY API SETTING: PREDICTION API
        // =======================================================
        const PREDICTION_API_URL = 'https://api.igrisapp.com/v1/latest'; 
        const PREDICTION_FETCH_INTERVAL = 10000; 

        // =======================================================
        // 2. MUKHY API SETTING: FIREBASE CONFIG (ZARUR BADLEIN)
        // =======================================================
        const firebaseConfig = {
            apiKey: "YOUR_FIREBASE_API_KEY", // <-- APNA API KEY DAALEIN
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://igris-1a02c-default-rtdb.firebaseio.com", 
            projectId: "YOUR_PROJECT_ID", // <-- APNA PROJECT ID DAALEIN
            // Baaki fields bhi yahan daal sakte hain (eg. storageBucket, messagingSenderId)
        };

        // Firebase Initialization
        let db;
        try {
            if (!firebaseConfig.apiKey.includes('YOUR_')) {
                const app = firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                console.log("Firebase initialized.");
            } else {
                console.warn("Firebase config is incomplete. Using placeholder keys.");
            }
        } catch(e) {
            console.error("Firebase Initialization Error:", e);
        }

        // Helper function for loading state
        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = '<div class="loading-animation"></div> Loading...';
            document.getElementById(elementId).classList.remove('error-text');
        }

        /**
         * Custom Prediction API se live data fetch karta hai.
         */
        async function fetchPrediction() {
            const periodElement = document.getElementById('currentPeriod');
            const predictionElement = document.getElementById('currentPrediction');
            showLoading('currentPeriod'); // Loading state dikhana
            predictionElement.textContent = '...';

            try {
                const response = await fetch(PREDICTION_API_URL, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP Status ${response.status}. Check API URL ya CORS policy.`);
                }
                
                const data = await response.json();
                
                // Data ko sahi tarah se extract karna
                const currentPeriod = data.period || 'N/A';
                const currentPrediction = String(data.prediction || 'N/A').toUpperCase();

                // UI Update
                periodElement.innerHTML = ''; // Loading animation hatana
                periodElement.textContent = currentPeriod;
                predictionElement.textContent = currentPrediction;

                // Color Logic
                predictionElement.classList.remove('text-red-500', 'text-green-500', 'text-purple-500', 'text-white');
                switch (currentPrediction) {
                    case 'RED': predictionElement.classList.add('text-red-500'); break;
                    case 'GREEN': predictionElement.classList.add('text-green-500'); break;
                    case 'VIOLET': predictionElement.classList.add('text-purple-500'); break;
                    default: predictionElement.classList.add('text-white'); break;
                }

            } catch (error) {
                console.error('Prediction API Error:', error);
                periodElement.innerHTML = ''; // Loading animation hatana
                periodElement.textContent = 'API Error';
                periodElement.classList.add('error-text');
                predictionElement.textContent = 'FAIL';
                predictionElement.classList.add('error-text');
            }
        }

        /**
         * Firebase se live history data (Win/Loss) sync karta hai.
         */
        function syncHistoryFromFirebase() {
            const historyList = document.getElementById('historyList');
            
            if (!db || firebaseConfig.apiKey.includes('YOUR_')) {
                historyList.innerHTML = '<p class="text-center error-text">Firebase configuration error. Credentials daalein.</p>';
                return;
            }

            historyList.innerHTML = '<p class="text-center text-gray-400"><div class="loading-animation"></div> Listening for updates...</p>';
            
            // FIREBASE PATH: Kripya is path ko apne asli history path se badlein!
            const historyRef = db.ref('results/history_data').limitToLast(15); 

            historyRef.on('value', (snapshot) => {
                const results = snapshot.val();
                historyList.innerHTML = ''; // Purana content clear karna
                
                if (!results) {
                    historyList.innerHTML = '<p class="text-center text-gray-500">Koi History Record nahi mila.</p>';
                    return;
                }
                
                const historyArray = Object.keys(results).map(key => ({
                    period: key,
                    result: results[key].status || 'N/A' // Maan lijiye Firebase mein 'status' field hai
                })).reverse(); // Latest result sabse upar

                historyArray.forEach(item => { 
                    const resultStatus = item.result || 'N/A';
                    const resultClass = resultStatus.toLowerCase() === 'win' ? 'win' : 'loss';
                    
                    const historyItem = document.createElement('div');
                    historyItem.className = 'flex justify-between items-center p-3 rounded-lg border border-gray-700 text-sm font-mono transition-colors';
                    historyItem.innerHTML = `
                        <span class="text-gray-400">Period: #${item.period}</span>
                        <span class="font-bold ${resultClass} text-lg">${resultStatus.toUpperCase()}</span>
                    `;
                    historyList.appendChild(historyItem);
                });

            }, (error) => {
                console.error("Firebase History Fetch Error:", error);
                historyList.innerHTML = '<p class="text-center error-text">Firebase data load nahi ho paya. Path ya Rules check karein.</p>';
            });
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            // Prediction API ko turant call karna aur phir interval set karna
            fetchPrediction();
            setInterval(fetchPrediction, PREDICTION_FETCH_INTERVAL);

            // Firebase History sync shuru karna
            syncHistoryFromFirebase();
        });
    </script>
</body>
</html>
